const toolInfos={device:window.location.href.includes("mobile")?"mobile":"desktop",type:window.location.href.includes("serigrafia")?"serigrafia":"digital"},rgbToHex=e=>{const t=(e="")=>e.toString(16).padStart(2,"0").toUpperCase(),s=e.replace("(","").replace(")","").replace("rgb","").split(", ");return`#${t(parseInt(s[0]))}${t(parseInt(s[1]))}${t(parseInt(s[2]))}`},presetText=e=>{const t=$("#elemento-"+e),s=t.css("font-size"),i=t.css("font-family").replaceAll('"',"");$("#font-size-select span.changed-option").html(s),$("#font-select span.changed-option").css("font-family",i).html(i)},busca=(e,t)=>{$(t).show(),e&&$(`${t}:not([title^="${e}"])`).hide()},htmlString=(e,...t)=>{let s=e.reduce(((e,s,i)=>e+s+(t[i]||"")),"");return s=s.replace(/>\s+</g,"><"),s=s.replace(/<(\w+)([\s\S]*?)?>/g,((e,t,s)=>`<${t}${s.replace(/\n|\r|\s+/g," ")}>`)),s=s.replace(/(\S+)\s*=\s*(['"][^'"]*['"])/g,((e,t,s)=>`${t}=${s}`)),s},setCurrentStyles=(e="")=>document.getElementById("current-styles").innerHTML=e,fixElementsIcons=(e,t=0)=>e&&setCurrentStyles(`\n    #elemento-${e} .excluir-elemento {\n        transform: rotate(${0-t}deg);\n    }\n\n    #elemento-${e} .resizable-r:before {\n        transform: rotate(${0-t}deg);\n    }\n    \n    #elemento-${e} .ui-rotatable-handle:before {\n        transform: rotate(${0-t}deg);\n    }\n`),sleep=e=>new Promise((t=>setTimeout(t,e))),getElementType=e=>{const t=e instanceof jQuery?e:$(e),s={isTextType:!1,isIconType:!1,isImgSvgType:!1,isImgSvgQrcodeType:!1,type:""};return t.hasClass("text")?{...s,type:"text",isTextType:!0}:t.hasClass("icon")?{...s,type:"icon",isIconType:!0}:t.hasClass("img-svg")?{...s,type:"img-svg",isImgSvgType:!0}:t.hasClass("img-svg-qrcode")?{...s,type:"img-svg-qrcode",isImgSvgQrcodeType:!0}:s},getElementColor=e=>{const t=e instanceof jQuery?e:$(e),{isTextType:s}=getElementType(t);let i=s?t.css("color"):t.css("fill");return i.includes("#")||(i=rgbToHex(i)),i},mirrorElement=(e="x")=>()=>{const t=$(".selecionado");let s=parseInt(t.attr("data-espelharX")),i=parseInt(t.attr("data-espelharY"));"x"===e&&(s=1===s?-1:1),"y"===e&&(i=1===i?-1:1);const{isIconType:n,isImgSvgType:a,isTextType:o}=getElementType(t);n?(t.children("svg").css("transform",`scaleX(${s}) scaleY(${i})`),t.children("img").css("transform",`scaleX(${s}) scaleY(${i})`)):a?t.children("img").css("transform",`scaleX(${s}) scaleY(${i})`):o&&t.children("span").css({display:"inline-block",transform:`scaleX(${s}) scaleY(${i})`}),t.attr({"data-espelharX":s,"data-espelharY":i}),t.trigger("mouseup");try{saveModificationHistory("mirrorElement "+e)}catch(e){}},deleteSelectedElement=()=>{removeElements(),hideElements();try{saveModificationHistory("deleteSelectedElement")}catch(e){}},getFileImageDimensions=async e=>{if(!e)return{};let t,s,i,n=window.URL||window.webkitURL;return await new Promise((a=>{const o=n.createObjectURL(e);t=new Image,t.onload=function(){s=this.width,i=this.height,n.revokeObjectURL(o),a()},t.src=o})),{x:s,y:i}},getQueryParameters=(e=window.location.href)=>{if(-1===e.indexOf("?"))return{};const t=e.split("?")[1].split("&"),s={};for(const e of t){const[t,i]=e.split("=");s[decodeURIComponent(t)]=decodeURIComponent(i)}return s},hideElements=()=>{$(".selecionado").removeClass("selecionado"),$("div.layer").removeClass("selected"),$(".excluir-elemento").hide(),$(".resizable-r").hide(),$(".ui-rotatable-handle").hide(),$(".ui-resizable-handle").hide(),$("div.custom-session div.surrounded-session").hide(),$("div.custom-session div.infos-content").fadeIn(500)},showSpinner=()=>$("#spinner").fadeIn(300),hideSpinner=()=>$("#spinner").fadeOut(300),setElementTextAlign=(e="left")=>()=>{$(".selecionado").css("text-align",e),$("div.action-text-align-left").removeClass("active"),$("div.action-text-align-center").removeClass("active"),$("div.action-text-align-right").removeClass("active"),$(`div.action-text-align-${e}`).addClass("active");try{saveModificationHistory("setElementTextAlign "+e)}catch(e){}},setElementFontBold=()=>{const e=$(".selecionado");700==e.css("font-weight")?(e.css("font-weight",400),$("div.action-text-bold").removeClass("active")):(e.css("font-weight","700"),$("div.action-text-bold").addClass("active"));try{saveModificationHistory("setElementFontBold")}catch(e){}},setElementFontItalic=()=>{const e=$(".selecionado");"italic"==e.css("font-style")?(e.css("font-style","normal"),$("div.action-text-italic").removeClass("active")):(e.css("font-style","italic"),$("div.action-text-italic").addClass("active"));try{saveModificationHistory("setElementFontItalic")}catch(e){}},svg_url=(e,t)=>`https://ecovasos.com/qero/personalizacion_online/svg/${e}/${t}`,svg_medidor_url=(e,t)=>`https://ecovasos.com/qero/personalizacion_online/svg_medidor/${toolInfos.type}/${e}/${t}`,rule3=(e,t,s)=>s*t/e,artToCanvas=(e=1)=>new Promise((t=>{html2canvas(document.querySelector("div#html2canvas"),{scale:e}).then(t)})),ajaxPromise=async(e={})=>new Promise(((t,s)=>$.ajax({...e,success:t,error:s}))),defaultSvgImgSizes={width:{desktop:{serigrafia:180,digital:550},mobile:{serigrafia:150,digital:650}},height:{desktop:{serigrafia:80,digital:250},mobile:{serigrafia:70,digital:235}}},verifyImageSize=async(e,t,s=0)=>{const i=e.clientHeight,n=e.clientWidth;if(!i||!n)return;const a=$("#elemento-"+t),o=defaultSvgImgSizes.width[toolInfos.device][toolInfos.type],l=defaultSvgImgSizes.height[toolInfos.device][toolInfos.type];if(s)a.css("width",s);else if(i>n){const e=rule3(n,i,l);a.css("width",e>o?o:e)}else a.css("width",o);e.removeAttribute("onload"),a.css({opacity:1})},matrixToDeg=(e="")=>{const t=e?.match(/matrix\((.+)\)/)[1].split(", "),s=parseFloat(t[0]),i=parseFloat(t[1]);parseFloat(t[2]),parseFloat(t[3]);return 180*Math.atan2(i,s)/Math.PI},fixElementsInCanvas=async()=>{const e=document.getElementById("html2canvas");e.style.fontFeatureSettings='"liga" 0',e.style.fontVariant="normal",$("#html2canvas div.elemento.text").each((function(){const e=$(this),t=e.css("font-family");if(["Amigos",'"Lovely Valentine"'].includes(t)){const s='"Lovely Valentine"'==t?-10:25,i=parseInt(e.css("top").replace("px",""))-s;e.css("top",i)}}));"serigrafia"==toolInfos.type&&$("#html2canvas #medidor img").attr("src")&&(async()=>{const e=$("#html2canvas #medidor img").attr("src"),t=await fetch(e),s=(await t.text())?.replace('<?xml version="1.0"?>',""),i=$("#html2canvas #medidor").width(),n=$("#html2canvas #medidor").height();$("#html2canvas #medidor img").remove(),$("#html2canvas #medidor").css({width:i,height:n}).append(s)})(),await sleep(100),await new Promise((e=>{if(!$("#html2canvas div.elemento.icon").length)return e();let t=0;$("#html2canvas div.elemento.icon").each((async function(){const s=$(this),i=s.find("img");if(i.length){const e=i.attr("src"),t=await fetch(e),n=(await t.text())?.replace('<?xml version="1.0"?>',""),a=s.width(),o=s.height(),l=s.attr("data-espelhary"),r=s.attr("data-espelharx"),c=window.getComputedStyle(s[0]).getPropertyValue("transform");if(s.find("img").remove(),s.css({width:a,height:o}),s.append(n),s.find("svg").attr({width:a,height:o}),c.includes("matrix")){const e=matrixToDeg(c);s.css("transform",`rotate(${e}deg) scaleX(${r}) scaleY(${l})`)}else s.css("transform",`scaleX(${r}) scaleY(${l})`)}t++,t===$("#html2canvas div.elemento.icon").length&&e()}))})),await sleep(100)},sequentialArray=(e=1)=>Array(e).fill(1).map(((e,t)=>t+e));document.addEventListener("DOMContentLoaded",(()=>{$(document).on("click","#close-spinner",hideSpinner)}));